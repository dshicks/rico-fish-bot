<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Rico Fish Bot</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
  h1 { margin-bottom: 20px; }
  section { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
  textarea { width: 100%; height: 100px; margin-bottom: 10px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 8px; border-bottom: 1px solid #ddd; }
  select, button, input { padding: 10px; margin-top: 10px; }
</style>
</head>
<body>
<h1>Admin Panel</h1>

<section id="login-section">
  <h2>Login</h2>
  <input type="password" id="admin-password" placeholder="Enter password">
  <button onclick="login()">Login</button>
</section>

<div id="admin-content" style=" Model</h2>
    <textarea id="prompt-input" placeholder="Enter training prompt..."></textarea>
    <button onclick="submitPrompt()">Submit Prompt</button>
    <div id="prompt-history"></div>
  </section>

  <!-- Sentiment -->
  <section>
    <h2>Set Response Sentiment</h2>
    <select id="sentiment-select">
      <option value="friendly">Friendly</option>
      <option value="fish-or-die">Fish or Die</option>
      <option value="professional">Professional</option>
    </select>
    <button onclick="updateSentiment()">Update Sentiment</button>
  </section>

  <!-- Chat History -->
  <section>
    <h2>User Chat History</h2>
    <table>
      <thead><tr><th>User</th><th>Message</th><th>Bot Response</th><th>Time</th></tr></thead>
      <tbody id="chat-history"></tbody>
    </table>
  </section>
</div>

<script>
let token = '';

async function login() {
  const password = document.getElementById('admin-password').value;
  const res = await fetch('/api/admin/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ password })
  });
  const data = await res.json();
  if (data.success) {
    token = data.token;
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('admin-content').style.display = 'block';
    loadPromptHistory();
    loadChatHistory();
  } else {
    alert('Invalid password');
  }
}

async function submitPrompt() {
  const prompt = document.getElementById('prompt-input').value.trim();
  if (!prompt) return alert('Enter a prompt!');
  await fetch('/api/admin/train', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': token },
    body: JSON.stringify({ prompt })
  });
  document.getElementById('prompt-input').value = '';
  loadPromptHistory();
}

async function updateSentiment() {
  const sentiment = document.getElementById('sentiment-select').value;
  await fetch('/api/admin/sentiment', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': token },
    body: JSON.stringify({ sentiment })
  });
  alert('Sentiment updated!');
}

async function loadPromptHistory() {
  const res = await fetch('/api/admin/prompts', { headers: { 'Authorization': token } });
  const prompts = await res.json();
  document.getElementById('prompt-history').innerHTML = '<h3>Prompt History</h3>' + prompts.map(p => `<p>${p}</p>`).join('');
}

async function loadChatHistory() {
  const res = await fetch('/api/admin/history', { headers: { 'Authorization': token } });
  const chats = await res.json();
  const rows = chats.map(c => `<tr><td>${c.user}</td><td>${c.message}</td><td>${c.bot}</td><td>${c.time}</td></tr>`).join('');
  document.getElementById('chat-history').innerHTML = rows;
}
</script>
</body>
</html>
