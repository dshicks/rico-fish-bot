<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rico Fish Bot</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f0f8ff; margin: 0; color: #333; }
    header { background: url('sunrise-over-redfish-bay.jpg') center/cover no-repeat; padding: 80px 20px; text-align: center; }
    header h1 { font-size: 2.5em; margin-bottom: 10px; color: rgb(5, 5, 78); }
    header p { font-size: 1.2em; margin-bottom: 20px; color: rgb(5, 5, 78); }
    .cta-buttons button { margin: 5px; padding: 10px 20px; font-size: 1em; border: none; border-radius: 5px; cursor: pointer; }
    .start { background-color: #0078d4; color: white; }
    section { padding: 40px 20px; max-width: 800px; margin: auto; }
    #chat-box p { padding: 8px; border-radius: 6px; margin: 5px 0; }
    .user-msg { background: #d1e7ff; text-align: right; }
    .bot-msg { background: #e6f7ff; text-align: left; }
  </style>
</head>
<body>
  <header>
    <h1>Rico Fish Bot</h1>
    <p>Your AI Fishing Guide for the Texas Coast</p>
    <div class="cta-buttons">
      <button class="start">Start Chatting</button>
    </div>
  </header>

  <section>
    <h2>üé£ Chat with Rico Fish Bot</h2>
    <div id="chat-box" style="background:#f9f9f9; border:1px solid #ccc; padding:15px; border-radius:10px; max-height:300px; overflow-y:auto;"></div>
    <form id="chat-form" style="margin-top:10px;">
      <input type="text" id="user-input" placeholder="Ask Rico where to fish..." style="width:75%; padding:10px;" />
      <button type="submit" style="padding:10px;">Send</button>
    </form>
  </section>

  <script>
    const chatBox = document.getElementById('chat-box');
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');

    // API Keys (‚ö†Ô∏è For demo only! Use backend proxy in production)
    const OPENAI_API_KEY = "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";
    const WEATHER_API_KEY = "1e24ea016ffb7aaf0846b9dd682a2698";

    const OPENAI_URL = "https://api.openai.com/v1/chat/completions";

    chatForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const message = userInput.value.trim();
      if (!message) return;

      appendMessage("You", message, "user-msg");
      userInput.value = "";
      appendMessage("Rico Fish Bot", "üå§ Fetching weather data...", "bot-msg");

      try {
        const weatherInfo = await getWeatherData();

        appendMessage("Rico Fish Bot", "‚úÖ Weather loaded. Thinking...", "bot-msg");

        const response = await fetch(OPENAI_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: "gpt-4o",
            messages: [
              {
                role: "system",
                content: `You are Rico Fish Bot, a Texas coastal fishing guide. Use this real-time weather data:
                ${weatherInfo}
                Give practical, local fishing advice based on these conditions. Suggest bait, timing, and spots.`
              },
              { role: "user", content: message }
            ],
            temperature: 0.7
          })
        });

        const data = await response.json();
        const reply = data?.choices?.[0]?.message?.content || "‚ö†Ô∏è No response from ChatGPT.";
        updateLastBotMessage(reply);
      } catch (error) {
        console.error(error);
        updateLastBotMessage("‚ö†Ô∏è Error fetching weather or calling ChatGPT API.");
      }
    });


    async function getWeatherData() {
      const url = 'https://api.openweathermap.org/data/2.5/weather?lat=28.0206&lon=-97.0544&appid=1e24ea016ffb7aaf0846b9dd682a2698&units=imperial';
      const res = await fetch(url);
      const data = await res.json();

      // ‚úÖ Debug tip: log full response
      console.log("Weather API response:", data);

      // Validate response
      if (data.cod !== 200 || !data.main || !data.weather || !data.wind) {
        return "Weather data unavailable.";
      }

      // Extract values safely
      const temp = data.main.temp ?? "N/A";
      const feelsLike = data.main.feels_like ?? "N/A";
      const humidity = data.main.humidity ?? "N/A";
      const windSpeed = data.wind.speed ?? "N/A";
      const condition = data.weather[0]?.description ?? "N/A";

      // Return formatted string
      return `Temp: ${data.main.temp}¬∞F`
      //return `Temp: ${temp}¬∞F (Feels like ${feelsLike}¬∞F), Humidity: ${humidity}%, Wind: ${windSpeed} mph, Conditions: ${condition}`;
    }



    function appendMessage(sender, text, className) {
      const msg = document.createElement('p');
      msg.className = className;
      msg.innerHTML = `<strong>${sender}:</strong> ${text}`;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function updateLastBotMessage(text) {
      const botMessages = chatBox.querySelectorAll("p.bot-msg");
      if (botMessages.length > 0) {
        botMessages[botMessages.length - 1].innerHTML = `<strong>Rico Fish Bot:</strong> ${text}`;
      }
    }
  </script>
</body>
</html>


