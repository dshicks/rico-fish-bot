<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fishing Map - Rico Fish Bot</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { margin: 0; font-family: 'Segoe UI', sans-serif; }
  #map { height: 100vh; width: 100%; }
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const BASE_URL = "https://rico-fish-bot-backend.onrender.com";

// ✅ Initialize Leaflet map
const map = L.map('map').setView([28.0, -97.0], 8); // Texas coast center

// ✅ Add tile layer
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// ✅ Escape HTML for safety
function escapeHtml(str) {
  if (!str) return '';
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

// ✅ Load locations dynamically from backend
async function loadMapLocations() {
  try {
    const res = await fetch(`${BASE_URL}/api/locations`); // Public route
    const locations = await res.json();

    if (!Array.isArray(locations) || locations.length === 0) {
      console.warn('No locations found.');
      return;
    }

    locations.forEach(loc => {
      if (!loc.lat || !loc.lng) return; // skip invalid coords
      const marker = L.marker([loc.lat, loc.lng]).addTo(map);
      marker.bindPopup(`
        <b>${escapeHtml(loc.name)}</b><br>
        ${escapeHtml(loc.description || '')}
      `);
    });
  } catch (err) {
    console.error('Failed to load locations:', err);
  }
}

// ✅ Call loader
loadMapLocations();
</script>

</body>
</html>
